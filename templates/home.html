<!DOCTYPE html>
<html>

<head>
    <title>Système Expert</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
        integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <link rel="stylesheet" href="{{url_for('static', filename='css/home.css') }}">


</head>

<body>
    <br>
    <div class="row">
        <div class="col">
            <div class="label" style="text-align: center; margin:5px;">Combien d'équations avez vous dans le système?</div>
            <input id="inputeq" placeholder="1" class="form-control" style="text-align: center; width: 40%; margin: auto;" type="number" min="1" max="10">
        </div>
    </div>
    <br>
    <div class="container equations">
        <div class="row">
            <div class="input-group equation" style="margin: 3px;">
                <div class="input-group-prepend">
                  <span class="input-group-text">Equation</span>
                </div>
                <input id="premisse" type="text" aria-label="premisse" class="form-control premisse" style="text-align:center;" placeholder="Prémisse">
                <input id="conclusion" type="text" aria-label="conclusion" class="form-control conclusion" style="text-align:center;" placeholder="Conclusion">
            </div>
        </div>
    </div>
    <div class="container">
        <br>
        <div class="row">
            <div class="col">
                <label for="hypothese">Hypothèses</label>
                <div class="input-group">
                    <input id="hypothese" type="text" class="form-control hypothese" style="text-align:center;" placeholder="Hypothèses">
                </div>
            </div>
            <div class="col">
                <label for="solution">Solutions</label>
                <div class="input-group">
                    <input id="solution" type="text" style="text-align:center;" class="form-control">
                </div>
            </div>
        </div>
        <br>
        <div class="row">
            <div class="col">
                <button id="launch" onclick="resolve()" type="button" class="btn btn-secondary">Start</button>
                <button id="reset" onclick="reset()" type="button" class="btn btn-secondary">Reset</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
        integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
        crossorigin="anonymous"></script>
</body>

</html>

<script>

    $(document).ready(function () {
        $('#solution').attr('disabled', 'disabled');
        $('#reset').attr('disabled', 'disabled');

        $('#inputeq').change(function () {
            var form = document.getElementById("inputeq");
            var entry = this.value;
            var count = 0;
            $('.equation').each(function () {
                count += 1;
            })
            diff = count - entry;
            if (form.checkValidity()) {
                if (diff < 0) {
                    for (var i = 0; i < (Math.abs(diff)); i++) {
                        $('.equations').append('<div class="row"><div class="input-group equation" style="margin: 3px;"><div class="input-group-prepend"><span class="input-group-text">Equation</span></div><input type="text" aria-label="premisse" class="form-control premisse" style="text-align:center;" placeholder="Prémisse"><input type="text" aria-label="conclusion" class="form-control conclusion" style="text-align:center;" placeholder="Conclusion"></div></div>');
                    }
                }
                else {
                    for (var j = 0; j < (Math.abs(diff)); j++) {
                        $('.equation').last().remove();
                    }
                }
            }
        })
    });

    function ajax_eq(myDic){
        $.ajax({
                type: "POST",
                async: false,
                data: myDic,
                url: '/create_eq'
        })
    }
    function ajax_hyp(hypDic){
        $.ajax({
            type: "POST",
            async: false,
            data: hypDic,
            url: '/create_hyp'
        })
    }
    function ajax_sol(){
        $.ajax({
            type: "POST",
            async: false,
            url: '/generate_solutions',
            success: function (res) {
                $('#solution').val(res)
            }
        })
    }
    function ajax_reset(){
        $.ajax({
            type: "POST",
            async: false,
            url: '/reset',
        })
    }

    function resolve() {
        $('.premisse').attr('disabled', 'disabled');
        $('.conclusion').attr('disabled', 'disabled');
        $('#hypothese').attr('disabled', 'disabled');
        $('#launch').attr('disabled','disabled');
        $('#reset').attr('disabled', false);

        $('.equation').each(function () {
            var prem = $(this).find('.premisse').val();
            var conc = $(this).find('.conclusion').val();
            var myDic = {
                'premisse': prem,
                'conclusion': conc,
            }
            ajax_eq(myDic);
        })
        var hyp = $('.hypothese').val();
        var hypDic = {
            'hypothese': hyp
        }
        ajax_hyp(hypDic);
        ajax_sol();
    }

    function reset() {
        $('.premisse').attr('disabled', false);
        $('.conclusion').attr('disabled', false);
        $('#hypothese').attr('disabled', false);
        $('#launch').attr('disabled', false);
        $('#reset').attr('disabled', 'disabled');
        $('#solution').val("")

        ajax_reset();
    }

</script>


